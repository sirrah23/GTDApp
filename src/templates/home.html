<html>
  <head>
    <title>GTD App</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/vue"></script>
    <style>
        #app {
            display: grid;
            grid-template-columns: 450px auto 450px;
            grid-template-rows: 35px auto;
        }

        .header {
            grid-column: 2 / 4;
        }

        .content {
            grid-column: 2 / 4;
        }

        #button-forward{
            justify-self: start;
        }

        #button-back{
            justify-self: end;
        }

    </style>
  </head>
  <body>
    {% raw %}
    <div class="container">
      <div id="app">
          <input id="add_gtd_thing" 
            :placeholder="`New ${modeStr.toLowerCase()} item`"
            v-on:keyup.enter="addGTDThing()"
            v-model="newGTDThing"></input>
          <!-- TODO: Inline these buttons...flexbox? -->
          <div class="header">
            <span id="button-back"><button v-on:click="toggleModeBackward()"><<<</button></span>
            <span id="button-forward"><button v-on:click="toggleModeForward()">>>></button></span>
          </div>
          <div class="content">
            <span id="mode"> <h1>{{ modeStr }}</h1></span>
            <!-- Items or Someday/Maybe list -->
            <ul id="items" v-if="mode === 0 || mode === 1">
                <li v-for="item in items" v-if="item.location === modeStr.toLowerCase()">
                    {{ item.description }}
                </li>
            </ul>
            <!-- Task List -->
            <ul id="tasks" v-if="mode === 2">
                <li v-for="task in tasks">
                    {{ task.description }} ---- {{ task.status.toUpperCase() }}
                </li>
            </ul>
            <!-- Project List -->
            <ul id="projects" v-if="mode === 3">
                <li v-for="project in projects">
                    task.description
                    <ul class="project-tasks">
                        <li v-for="task in project.tasks">
                            <!-- TODO: Task component? We could abstract it and use it in two places-->
                            {{ task.description }} ---- {{ task.status.toUpperCase() }}
                        </li>
                    </ul>
                </li>
            </ul>
            <a href="/logout">Logout</a>
        <div>
      </div>
    </div>
    {% endraw %}
  </body>
  <script>
    //NOTE: Temporary, stub API connection until we get a real one going
    const APIConn = {
        addNewItem(itemDescription){
            return new Promise((resolve, reject) => {
                resolve({
                    id: Math.floor(Math.random() * 15),
                    description: itemDescription,
                    location: "inbox"
                })
            });
        },
    }
    const app = new Vue({
        el: '#app',
        data: {
            mode: 0,
            modeStrs: ["Inbox", "Someday/Maybe", "Tasks", "Projects"],
            newGTDThing: "",
            // TODO: Unhardcode this stuff once we have the api
            items: [
                {id: "1", description: "A random thought", location: "inbox"},
                {id: "2", description: "Another random thought", location: "inbox"},
                {id: "3", description: "Project A", location: "inbox"},
                {id: "4", description: "I should buy a house", location: "someday/maybe"},
                {id: "5", description: "I should buy a boat", location: "someday/maybe"}
            ],
            tasks: [
                {id: "6", description: "Task 1", status: "todo"},
                {id: "7", description: "Task 2", status: "todo"},
                {id: "8", description: "Task 3", status: "done"},
            ],
            projects: [
                {id: "9", description: "Project A", tasks:[]},
                {id: "10",
                 description: "Project B",
                 tasks:[
                     {id: "12", description: "Project A Task 1", status: "next"},
                     {id: "13", description: "Project A Task 2", status: "todo"},
                 ]
                },
                {id: "11", description: "Project C",
                 tasks:[
                     {id: "14", description: "Project C Task 1", status: "todo"},
                 ]
                },
            ]
        },
        computed: {
            modeStr(){
                return this.modeStrs[this.mode];
            }
        },
        methods: {
            //TODO: Create a generic number-wrap function for both toggle-forward and toggle-backward
            toggleModeForward(){
                this.mode = (this.mode + 1) % this.modeStrs.length; 
            },
            toggleModeBackward(){
                this.mode = (this.mode - 1);
                if(this.mode < 0){
                    this.mode = this.modeStrs.length - 1;
                }
            },
            addGTDThing(){
                if(this.newGTDThing.length > 0){
                    APIConn.addNewItem(this.newGTDThing)
                    .then((res) => {
                        this.newGTDThing = "";
                        this.items.push(res);
                    })
                }
            }
        }
    })
  </script>
</html>
